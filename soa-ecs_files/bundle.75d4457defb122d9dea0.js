!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}({12:function(e,t){},13:function(e,t,n){"use strict";n.r(t);const s=(e,t,n)=>{const s=window.devicePixelRatio||1;return 1!=s&&(e.style.width=t+"px",e.style.height=n+"px"),e.width=t*s,e.height=n*s,s};var i,r;!function(e){e[e.U8=0]="U8",e[e.U8C=1]="U8C",e[e.I8=2]="I8",e[e.U16=3]="U16",e[e.I16=4]="I16",e[e.U32=5]="U32",e[e.I32=6]="I32",e[e.F32=7]="F32",e[e.F64=8]="F64"}(i||(i={})),function(e){e[e.I8=5120]="I8",e[e.U8=5121]="U8",e[e.I16=5122]="I16",e[e.U16=5123]="U16",e[e.I32=5124]="I32",e[e.U32=5125]="U32",e[e.F32=5126]="F32"}(r||(r={})),r.I8,i.I8,r.U8,i.U8,r.I16,i.I16,r.U16,i.U16,r.I32,i.I32,r.U32,i.U32,r.F32,i.F32,i.I8,r.I8,i.U8,r.U8,i.U8C,r.U8,i.I16,r.I16,i.U16,r.U16,i.I32,r.I32,i.I32,r.I32,i.U32,r.U32,i.F32,r.F32,i.F64,i.U8,i.U8C,i.I8,i.U16,i.I16,i.U32,i.I32,i.F32,i.F64;const o={[i.U8]:Uint8Array,[i.U8C]:Uint8ClampedArray,[i.I8]:Int8Array,[i.U16]:Uint16Array,[i.I16]:Int16Array,[i.U32]:Uint32Array,[i.I32]:Int32Array,[i.F32]:Float32Array,[i.F64]:Float64Array,[r.U8]:Uint8Array,[r.I8]:Int8Array,[r.U16]:Uint16Array,[r.I16]:Int16Array,[r.U32]:Uint32Array,[r.I32]:Int32Array,[r.F32]:Float32Array};function a(e,...t){return new o[e](...t)}const l=e=>e<=256?i.U8:e<=65536?i.U16:i.U32;function c(e,t,n,s){var i,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(r<3?i(o):r>3?i(t,n,o):i(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o}Object.create,Object.create;const u=Symbol(),d=()=>{},f="undefined"==typeof process||"1"===process.env.UMBRELLA_ASSERTS?(e,t="assertion failed")=>{if("function"==typeof e&&!e()||!e)throw new Error("function"==typeof t?t():t)}:d,h=(e,t={})=>{const n=Reflect.ownKeys(e),s=Reflect.ownKeys(t),i=Symbol("isa");function r(t){for(let s of n){const n=Object.getOwnPropertyDescriptor(t.prototype,s);!n||n.configurable?Object.defineProperty(t.prototype,s,{value:e[s],writable:!0}):console.log(`not patching: ${t.name}.${s.toString()}`)}return Object.defineProperty(t.prototype,i,{value:!0}),t}for(let e of s)Object.defineProperty(r,e,{value:t[e],enumerable:t.propertyIsEnumerable(e)});return Object.defineProperty(r,Symbol.hasInstance,{value:e=>!!e[i]}),r},p=(e,t)=>{if(e)for(let n,s=0,i=e.length;s<i;s++)if(n=e[s],n[0].call(n[1],t),t.canceled)return},_=h({addListener(e,t,n){let s=(this._listeners=this._listeners||{})[e];return!s&&(s=this._listeners[e]=[]),-1===this.__listener(s,t,n)&&(s.push([t,n]),!0)},removeListener(e,t,n){let s;if(!(s=this._listeners))return!1;const i=s[e];if(i){const r=this.__listener(i,t,n);if(-1!==r)return i.splice(r,1),!i.length&&delete s[e],!0}return!1},notify(e){let t;if(!(t=this._listeners))return!1;void 0===e.target&&(e.target=this),p(t[e.id],e),p(t["*"],e)},__listener(e,t,n){let s=e.length;for(;--s>=0;){const i=e[s];if(i[0]===t&&i[1]===n)break}return s}}),E=Array.isArray,g=e=>"string"==typeof e;let R=class{constructor(e=32,t=32-e,n=2**e,s=0){const i=2**e;f(e>0&&e+t<=32,"wrong total bit size [1..32]"),f(n<=i,`requested capacity too large for bit size (max. ${i})`),this.ids=[],this.nextID=s,this.start=s,this._capacity=n,this.num=0,this.mask=i-1,this.vmask=(1<<t)-1,this.shift=e,this._freeID=-1}id(e){return e&this.mask}version(e){return e>>>this.shift&this.vmask}get capacity(){return this._capacity}set capacity(e){if(f(!this.vmask,"can't change capacity w/ versioning enabled"),!(e>=this.mask+1))throw new Error("can't reduce capacity");{const t=Math.ceil(Math.log2(e));f(t>0&&t<=32,"wrong bit size for new capacity [1..32]"),this._capacity=e,this.mask=2**t-1,this.shift=t}}get available(){return this._capacity-this.num-this.start}get used(){return this.num}get freeID(){return this._freeID}*[Symbol.iterator](){for(let e=this.nextID;--e>=0;){const t=this.ids[e];(t&this.mask)===e&&(yield t)}}clear(){this.ids.length=0,this.nextID=this.start,this.num=0,this._freeID=-1}next(){let e;if(-1!==this._freeID){e=this._freeID;const t=this.id(e);this._freeID=this.ids[t],this.ids[t]=e}else f(this.nextID<this._capacity,"max capacity reached"),e=this.nextID++,this.ids[e]=e;return this.num++,this.notify({id:"added",target:this,value:e}),e}free(e){return!!this.has(e)&&(this.ids[this.id(e)]=this._freeID,this._freeID=this.nextVersion(e),this.num--,this.notify({id:"removed",target:this,value:e}),!0)}has(e){const t=this.id(e);return e>=0&&t<this.nextID&&this.ids[t]===e}addListener(e,t,n){}removeListener(e,t,n){}notify(e){}nextVersion(e){return(e&this.mask|(this.version(e)+1&this.vmask)<<this.shift)>>>0}};R=c([_],R);const I=e=>null!=e&&"function"==typeof e[Symbol.iterator],N=(e,t)=>[e[0],e[1],t],y=(e,t)=>null!=e&&"function"==typeof e[t],v=e=>y(e,"xform")?e.xform():e;class A{constructor(e){this.value=e}deref(){return this.value}}const T=e=>e instanceof A,m=e=>e instanceof A?e.deref():e,S=(e,t=(e=>void 0!==e?": "+e:""))=>class extends Error{constructor(n){super(e(n)+t(n))}},b=S(()=>"illegal arity"),G=e=>{throw new b(e)};function O(...e){const t=e[0],n=t[0],s=t[1],i=t[2],r=null==(e=(e=>2===e.length?[void 0,e[1]]:3===e.length?[e[1],e[2]]:G(e.length))(e))[0]?n():e[0],o=e[1];return m(s(y(o,"$reduce")?o.$reduce(i,r):null!=(a=o)&&"function"!=typeof a&&void 0!==a.length?L(i,r,o):U(i,r,o)));var a}const L=(e,t,n)=>{for(let s=0,i=n.length;s<i;s++)if(t=e(t,n[s]),T(t)){t=t.deref();break}return t},U=(e,t,n)=>{for(let s of n)if(t=e(t,s),T(t)){t=t.deref();break}return t},D=(e,t)=>[e,e=>e,t];function*F(e,t){const n=v(e)([d,d,(e,t)=>t])[2];for(let e of t){let t=n(u,e);if(T(t))return t=m(t.deref()),void(t!==u&&(yield t));t!==u&&(yield t)}}function B(e,t){return I(t)?F(B(e),t):t=>{const n=t[2];return N(t,(t,s)=>e(s)?n(t,s):t)}}const w=e=>"function"==typeof e;let P=class{constructor(e,t,n,s){this.id=e,this.sparse=t,this.dense=n,this.vals=s,this.n=0}keys(){return this.dense.slice(0,this.n)}*values(){for(let e=this.n;--e>=0;)yield this.getIndex(e)}has(e){const t=this.sparse[e];return t<this.n&&this.dense[t]===e}valueIndexForID(e){const t=this.sparse[e];return t<this.n&&this.dense[t]===e?t*this.stride:-1}valueIndexForIDUnsafe(e){return this.sparse[e]*this.stride}set(e,t){const n=this.sparse[e];return n<this.n&&this.dense[n]===e&&(this.setIndexUnsafe(n,t),!0)}setIndex(e,t){const n=this.dense[e];return e<this.n&&this.sparse[n]===e&&(this.setIndexUnsafe(e,t),!0)}add(e,t){const{dense:n,sparse:s,n:i}=this,r=n.length,o=s[e];if(e<r&&i<r&&!(o<i&&n[o]===e)){n[i]=e,s[e]=i,this.n++;const r=this.default,o=t||(w(r)?r():r);return void 0!==o&&this.setIndexUnsafe(i,o,!1),this.notify({id:"added",target:this,value:e}),!0}return!1}delete(e){let{dense:t,sparse:n,n:s}=this,i=n[e];if(i<s&&t[i]===e){this.notify({id:"pre-delete",target:this,value:e}),i=n[e];const r=t[--s];return t[i]=r,n[r]=i,this.n=s,this.moveIndex(s,i),!0}return!1}addListener(e,t,n){}removeListener(e,t,n){}notify(e){}notifyChange(e){this.notify({id:"changed",target:this,value:e})}};P=c([_],P);let $=class extends P{constructor(e,t,n){const s=(n=Object.assign({size:1,byteOffset:0},n)).size,i=n.stride||s;super(n.id,e,t,n.buf?a(n.type,n.buf,n.byteOffset,t.length*i):a(n.type,t.length*i)),this.type=n.type,this.size=s,this.stride=i,this.default=n.default,this.cache=n.cache}packedValues(){return this.vals.subarray(0,this.n*this.stride)}resize(e){if(f(e>=this.dense.length,"can't decrease capacity"),e===this.dense.length)return;const t=l(e),n=a(t,e),s=a(t,e),i=a(this.type,e*this.stride);n.set(this.sparse),s.set(this.dense),i.set(this.vals),this.sparse=n,this.dense=s,this.vals=i,this.cache&&this.cache.release()}get(e){let t=this.sparse[e];return this.dense[t]===e?this.getIndex(t):void 0}getIndex(e){return e<this.n?this.cache?this.cache.getSet(e,()=>(e*=this.stride,this.vals.subarray(e,e+this.size))):(e*=this.stride,this.vals.subarray(e,e+this.size)):void 0}setIndexUnsafe(e,t,n=!0){this.vals.set(t,e*this.stride),n&&this.notifyChange(this.dense[e])}swapIndices(e,t){if(e===t)return!1;const{dense:n,sparse:s,vals:i,size:r,stride:o}=this,a=n[e],l=n[t];n[e]=l,n[t]=a,s[a]=t,s[l]=e,e*=o,t*=o;const c=i.slice(e,e+r);return i.copyWithin(e,t,t+r),i.set(c,t),!0}moveIndex(e,t){const n=this.stride;e*=n,this.vals.copyWithin(t*n,e,e+this.size),this.cache&&this.cache.delete(t)}};$=c([_],$);let C=class extends P{constructor(e,t,n){super(n.id,e,t,new Array(t.length)),this.default=n.default}get size(){return 1}get stride(){return 1}packedValues(){return this.vals.slice(0,this.n)}resize(e){if(f(e>=this.dense.length,"can't decrease capacity"),e===this.dense.length)return;const t=l(e),n=a(t,e),s=a(t,e);n.set(this.sparse),s.set(this.dense),this.sparse=n,this.dense=s}get(e){let t=this.sparse[e];return t<this.n&&this.dense[t]===e?this.vals[t]:void 0}getIndex(e){return e<this.n?this.vals[e]:void 0}setIndexUnsafe(e,t,n=!0){this.vals[e]=t,n&&this.notifyChange(this.dense[e])}swapIndices(e,t){if(e===t)return!1;const{dense:n,sparse:s,vals:i}=this,r=n[e],o=n[t];n[e]=o,n[t]=r,s[r]=t,s[o]=e;const a=i[e];return i[e]=i[t],i[t]=a,!0}moveIndex(e,t){const n=this.vals;n[t]=n[e],delete n[e]}};C=c([_],C);const M=e=>(e=>e instanceof Set)(e)?e:new Set(e);function x(e,t){if((e=>e instanceof Map)(e))for(let n of t)e.set(n[0],n[1]);else for(let n of t)e.add(n);return e}const H=(e,t,n)=>{if(n=n||((e,t)=>y(e,"empty")?e.empty():new(e[Symbol.species]||t))(e,Set),e===t)return x(n,e);if(t.size<e.size)return H(t,e,n);for(let s of t)e.has(s)&&n.add(s);return n};function j(e){return((e,t,n)=>n?O(e(),n):[()=>null,e=>e||new Set,(e,n)=>e?t(e,M(n)):M(n)])(j,H,e)}function k(e,t){return I(t)?F(k(e),t):t=>{const n=t[2];return N(t,(t,s)=>n(t,e(s)))}}function z(...e){let t,n;switch(e.length){case 4:n=e[3],t=e[2];break;case 3:n=e[2];break;case 2:return k(t=>z(e[0],e[1],t));default:G(e.length)}return O(v(e[0])(e[1]),t,n)}class Y{constructor(){this.index=new Map}clear(){this.index.clear()}release(){return this.clear(),!0}keys(){return this.index.keys()}set(e,t){return this.index.set(e,t),t}get(e){return this.index.get(e)}getSet(e,t){let n=this.index.get(e);return void 0!==n?n:this.set(e,t())}delete(e){return this.index.delete(e)}}class q{constructor(e,t=e,n){this.components=e,this.ids=new Set,this.n=0,this.id=n.id,this.cache=n.cache||new Y,this.info=e.reduce((e,t)=>(e[t.id]={values:t.vals,size:t.size,stride:t.stride},e),{}),t.forEach(t=>{f(e.includes(t),`owned component ${t.id} not in given list`),f(!t.owner,()=>`component ${t.id} already owned by ${t.owner.id}`),t.owner=this}),this.owned=t,this.addExisting(),this.addRemoveListeners(!0)}release(){this.addRemoveListeners(!1),this.cache.release()}has(e){return this.ids.has(e)}values(){return this.isFullyOwning()?this.ownedValues():this.nonOwnedValues()}getIndex(e){return this.ensureFullyOwning(),e<this.n?this.getEntityUnsafe(this.components[0].dense[e]):void 0}getEntity(e){return this.has(e)?this.getEntityUnsafe(e):void 0}getEntityUnsafe(e){return this.cache.getSet(e,()=>{const t={id:e},n=this.components;for(let s=n.length;--s>=0;){const i=n[s];t[i.id]=i.getIndex(i.sparse[e])}return t})}run(e,...t){this.ensureFullyOwning(),e(this.info,this.n,...t)}forEachRaw(e,...t){this.ensureFullyOwning();const n=this.info,s=this.components[0].dense;for(let i=0,r=this.n;i<r;i++)e(n,s[i],i,...t)}forEach(e,...t){let n=0;for(let s of this.ids)e(this.getEntityUnsafe(s),n++,...t)}isFullyOwning(){return this.owned.length===this.components.length}isValidID(e){for(let t of this.components)if(!t.has(e))return!1;return!0}onAddListener(e){this.addID(e.value)}onDeleteListener(e){this.removeID(e.value)}onChangeListener(e){e.target instanceof C&&this.cache.delete(e.value)}addExisting(){const e=z(k(e=>e.keys()),j(),this.components);for(let t of e)this.addID(t,!1)}addID(e,t=!0){t&&!this.isValidID(e)||(this.ids.add(e),this.reorderOwned(e,this.n++))}removeID(e,t=!0){t&&!this.isValidID(e)||(this.ids.delete(e),this.reorderOwned(e,--this.n))}reorderOwned(e,t){const n=this.owned;if(!n.length)return;const s=n[0].dense[t];let i=!1;for(let s=n.length;--s>=0;){const r=n[s];i=r.swapIndices(r.sparse[e],t)||i}i&&(this.cache.delete(e),this.cache.delete(s))}*ownedValues(){const e=this.components[0].dense;for(let t=this.n;--t>=0;)yield this.getEntityUnsafe(e[t])}*nonOwnedValues(){for(let e of this.ids)yield this.getEntityUnsafe(e)}ensureFullyOwning(){f(this.isFullyOwning(),`group ${this.id} isn't fully owning its components`)}addRemoveListeners(e){const t=e?"addListener":"removeListener";this.components.forEach(e=>{e[t]("added",this.onAddListener,this),e[t]("pre-delete",this.onDeleteListener,this),e[t]("changed",this.onChangeListener,this)})}}let V=0,W=class{constructor(e=1e3){var t;this.idgen=new R((t=e)>1?Math.ceil(Math.log2(t)):0,0),this.components=new Map,this.groups=new Map}defEntity(e){const t=this.idgen.next();if(e)if(E(e)){if(!e.length)return t;for(let n of e){const e=g(n)?this.components.get(n):n;f(!!e,"unknown component ID: "+n),e.add(t)}}else for(let n in e){const s=this.components.get(n);f(!!s,"unknown component ID: "+n),s.add(t,e[n])}return this.notify({id:"added",target:this,value:t}),t}defComponent(e){f(!this.components.has(e.id),`component '${e.id}' already existing`);const t=this.idgen.capacity,n=l(t),s=a(n,t),i=a(n,t),r=void 0!==e.type?new $(i,s,e):new C(s,i,e);return this.components.set(e.id,r),r}defGroup(e,t=e,n={}){n=Object.assign({id:"group"+V++},n),f(!this.groups.has(n.id),`group '${n.id}' already existing`);const s=new q(e,t,n);return this.groups.set(s.id,s),s}hasID(e){this.idgen.has(e)}deleteID(e){if(this.idgen.free(e)){this.notify({id:"pre-delete",target:this,value:e});for(let t of this.componentsForID(e))t.delete(e);return!0}return!1}componentsForID(e){return B(t=>t.has(e),this.components.values())}groupsForID(e){return B(t=>t.has(e),this.groups.values())}setCapacity(e){this.idgen.capacity=e;for(let t of this.components.values())t.resize(e)}addListener(e,t,n){}removeListener(e,t,n){}notify(e){}};W=c([_],W);const X=Object.getPrototypeOf({}),K="function",Q=(e,t)=>{let n;return e===t||(null==e?e==t:typeof e.equiv===K?e.equiv(t):null==t?e==t:typeof t.equiv===K?t.equiv(e):"string"!=typeof e&&"string"!=typeof t&&(n=Object.getPrototypeOf(e),null!=n&&n!==X||(n=Object.getPrototypeOf(t),null!=n&&n!==X)?typeof e!==K&&void 0!==e.length&&typeof t!==K&&void 0!==t.length?Z(e,t):e instanceof Set&&t instanceof Set?J(e,t):e instanceof Map&&t instanceof Map?ee(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:te(e,t)))},Z=(e,t,n=Q)=>{let s=e.length;if(s===t.length)for(;--s>=0&&n(e[s],t[s]););return s<0},J=(e,t,n=Q)=>e.size===t.size&&n([...e.keys()].sort(),[...t.keys()].sort()),ee=(e,t,n=Q)=>e.size===t.size&&n([...e].sort(),[...t].sort()),te=(e,t,n=Q)=>{if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let s in e)if(!t.hasOwnProperty(s)||!n(e[s],t[s]))return!1;return!0};var ne;let se,ie;!function(e){e[e.ONLY_DISTANCE=0]="ONLY_DISTANCE",e[e.ONLY_DISTANCE_LINEAR=1]="ONLY_DISTANCE_LINEAR",e[e.ONLY_DISTANCE_LINEAR_ONLY_CHANGES=2]="ONLY_DISTANCE_LINEAR_ONLY_CHANGES",e[e.FULL=3]="FULL"}(ne||(ne={}));let re=[],oe=[];const ae=(e,t,n,s,i)=>{const r=t.length,o=e.linear;if(e.distance=r,i!==ne.ONLY_DISTANCE){for(let e=0,n=0;e<r;e++,n+=3)o[n]=s,o[n+1]=e,o[n+2]=t[e];if(i===ne.FULL){const s=e[n];for(let e=0;e<r;e++)s[e]=t[e]}}return e},le=(e,t,n,s,i,r)=>{const o=n.linear,a=n.const;let l,c,u,d,f=e.length,h=0,p=0;for(r?(l=n.dels,c=n.adds,u=-1,d=1):(l=n.adds,c=n.dels,u=1,d=-1);--f>=0;){const n=e[f],r=t[n],_=t[n+1],E=_-r;for(;h<r||p<_;){const e=p-h;E>e?(o.push(u,p,l[p]=i[p]),p++):E<e?(o.push(d,h,c[h]=s[h]),h++):(o.push(0,h,a[h]=s[h]),h++,p++)}}},ce=(e,t,n,s,i,r,o)=>{const a=n.linear,l=r?-1:1,c=r?1:-1;let u=e.length,d=0,f=0;for(;--u>=0;){const n=e[u],r=t[n],h=t[n+1],p=h-r;for(;d<r||f<h;){const e=f-d;p>e?(a.push(l,f,i[f]),f++):p<e?(a.push(c,d,s[d]),d++):(o&&a.push(0,d,s[d]),d++,f++)}}},ue=Array.isArray,de=Math.max,fe=Object.getPrototypeOf({}),he=(()=>{const e=new Array(2048);for(let t=2,n=e.length;t<n;t++)e[t]=t-2;return e})(),pe=(e,t,n,s,i,r=0)=>{const o=i[1];if(o.__skip)return;if(!1===o.__diff)return Ne(s),void t.replaceChild(e,n,r,i);const a=s[1];if(a&&a.__skip)return void t.replaceChild(e,n,r,i,!1);let l=o.__impl;if(l&&l!==t)return l.diffTree(e,l,n,s,i,r);const c=((e,t,n=ne.FULL,s=Q)=>{const i={distance:0,adds:{},dels:{},const:{},linear:[]};if(e===t||null==e&&null==t)return i;if(null==e||0===e.length)return ae(i,t,"adds",1,n);if(null==t||0===t.length)return ae(i,e,"dels",-1,n);const r=e.length>=t.length;let o,a,l,c;r?(o=t,a=e):(o=e,a=t),l=o.length,c=a.length;const u=l+1,d=c-l,f=d+u,h=l+c+3,p=(e=>ie&&ie.length>=e?ie:ie=new Int32Array(e))(h).fill(-1,0,h),_=(e=>se&&se.length>=e?se:se=new Int32Array(e))(h).fill(-1,0,h),E=re,g=oe,R=(e,t,n)=>{let i,r;t>n?(i=p[e-1],r=t):(i=p[e+1],r=n);let d=r-(e-u);for(;d<l&&r<c&&s(o[d],a[r]);)d++,r++;p[e]=g.length/3,g.push(d,r,i),_[e]=r};let I,N=-1;do{for(N++,I=-N+u;I<f;I++)R(I,_[I-1]+1,_[I+1]);for(I=f+N;I>f;I--)R(I,_[I-1]+1,_[I+1]);R(f,_[f-1]+1,_[f+1])}while(_[f]!==c);if(i.distance=d+2*N,n!==ne.ONLY_DISTANCE){for(N=3*p[f];N>=0;)E.push(N),N=3*g[N+2];n===ne.FULL?le(E,g,i,o,a,r):ce(E,g,i,o,a,r,n===ne.ONLY_DISTANCE_LINEAR)}return E.length=0,g.length=0,i})(s,i,ne.ONLY_DISTANCE_LINEAR,ve);if(0===c.distance)return;const u=c.linear,d=t.getChild(n,r);let f,h,p,_;if(0!==u[0]||s[1].key!==o.key)return Ne(s),void t.replaceChild(e,n,r,i);if((_=s.__release)&&_!==i.__release&&Ne(s),0!==u[3]&&(Ie(t,d,s[1],i[1]),2===c.distance))return;const E=u.length,g=s.length-1,R=ye(u),I=(e=>{if(e<=he.length)return he.slice(0,e);const t=new Array(e);for(;--e>=2;)t[e]=e-2;return t})(g+1);for(f=2,h=6;h<E;f++,h+=3)p=u[h],p&&(-1===p?_e(e,t,d,s,i,u,h,R,I,g):Ee(e,t,d,u,h,R,I,g));(_=i.__init)&&_!=s.__init&&_.apply(i,[d,...i.__args])},_e=(e,t,n,s,i,r,o,a,l,c)=>{const u=r[o+2];if(ue(u)){let d=u[1].key;if(void 0!==d&&void 0!==a[d][2]){const r=a[d];d=r[0],pe(e,t,n,s[d],i[r[2]],l[d])}else{const e=r[o+1];Ne(u),t.removeChild(n,l[e]),ge(l,c,e)}}else"string"==typeof u&&t.setContent(n,"")},Ee=(e,t,n,s,i,r,o,a)=>{const l=s[i+2];if("string"==typeof l)t.setContent(n,l);else if(ue(l)){const c=l[1].key;if(void 0===c||void 0===r[c][0]){const r=s[i+1];t.createTree(e,n,l,o[r]),Re(o,a,r)}}},ge=(e,t,n)=>{for(;t>n;t--)e[t]=de(e[t]-1,0)},Re=(e,t,n)=>{for(;t>=n;t--)e[t]++},Ie=(e,t,n,s)=>{const i=((e,t,n=ne.FULL,s=Q)=>e===t?{distance:0}:n===ne.ONLY_DISTANCE?((e,t,n)=>{e||(e={}),t||(t={});let s=0;for(let i in e){const r=t[i];(void 0===r||!n(e[i],r))&&s++}for(let n in t)!(n in e)&&s++;return{distance:s}})(e,t,s):((e,t,n)=>{e||(e={}),t||(t={});let s=0;const i=[],r=[],o=[];for(let i in e){const a=t[i];void 0===a?(r.push(i),s++):n(e[i],a)||(o.push(i,a),s++)}for(let n in t)n in e||(i.push(n),s++);return{distance:s,adds:i,dels:r,edits:o}})(e,t,s))(n,s,ne.FULL,Q);e.removeAttribs(t,i.dels,n);let r,o,a,l=u;for(a=i.edits,r=a.length;(r-=2)>=0;)o=a[r],"o"===o[0]&&"n"===o[1]&&e.removeAttribs(t,[o],n),"value"!==o?e.setAttrib(t,o,a[r+1],s):l=a[r+1];for(a=i.adds,r=a.length;--r>=0;)o=a[r],"value"!==o?e.setAttrib(t,o,s[o],s):l=s[o];l!==u&&e.setAttrib(t,"value",l,s)},Ne=e=>{if(ue(e)){let t;if((t=e[1])&&!1===t.__release)return;for(e.__release&&(e.__release.apply(e.__this,e.__args),delete e.__release),t=e.length;--t>=2;)Ne(e[t])}},ye=e=>{let t,n,s;const i={};for(let r=e.length;(r-=3)>=0;)n=e[r+2],ue(n)&&void 0!==(t=n[1].key)&&(s=i[t],!s&&(i[t]=s=[,,]),s[e[r]+1]=e[r+1]);return i},ve=(e,t)=>{let n;return e===t||(null==e?e==t:"function"==typeof e.equiv?e.equiv(t):null==t?e==t:"function"==typeof t.equiv?t.equiv(e):"string"!=typeof e&&"string"!=typeof t&&(n=Object.getPrototypeOf(e),null!=n&&n!==fe||(n=Object.getPrototypeOf(t),null!=n&&n!==fe)?"function"!=typeof e&&void 0!==e.length&&"function"!=typeof t&&void 0!==t.length?Z(e,t,ve):e instanceof Set&&t instanceof Set?J(e,t,ve):e instanceof Map&&t instanceof Map?ee(e,t,ve):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:!(!1===e.__diff||!1===t.__diff)&&te(e,t,ve)))},Ae=e=>null!=e&&"string"!=typeof e&&"function"==typeof e[Symbol.iterator],Te=/^([^\s\.#]+)(?:#([^\s\.#]+))?(?:\.([^\s#]+))?$/,me=(new RegExp(`[${Object.keys({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"}).join("")}]`,"g"),{button:1,option:1,script:1,style:1,text:1,textarea:1,title:1}),Se=e=>e.split(" ").reduce((e,t)=>(e[t]=!0,e),{}),be=Se("animate animateColor animateMotion animateTransform circle clipPath color-profile defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font foreignObject g image line linearGradient marker mask metadata mpath path pattern polygon polyline radialGradient rect set stop style svg switch symbol text textPath title tref tspan use view"),Ge=(Se("area base br circle col command ellipse embed hr img input keygen line link meta param path polygon polyline rect source stop track use wbr ?xml"),e=>(e=>null!=e&&"function"==typeof e.deref)(e)?e.deref():e),Oe=E,Le=Ae,Ue=g,De=(e,t)=>t.__init&&t.__init.apply(t.__this,[e,...t.__args]),Fe=(e,t,n,s,i,r=!0)=>{if(Oe(s)){const o=s[0];if("function"==typeof o)return Fe(e,t,n,o.apply(null,[e.ctx,...s.slice(1)]),i);const a=s[1];if(a.__impl)return a.__impl.createTree(e,n,s,i,r);const l=t.createElement(n,o,a,i);if(s.length>2){const n=s.length;for(let i=2;i<n;i++)Fe(e,t,l,s[i],void 0,r)}return r&&De(l,s),l}if(Le(s)){const o=[];for(let a of s)o.push(Fe(e,t,n,a,i,r));return o}return null==s?n:t.createTextElement(n,s)},Be=(e,t,n,s,i=0)=>{if(Oe(s)){const r=t.getChild(n,i);"function"==typeof s[0]&&Be(e,t,n,s[0].apply(null,[e.ctx,...s.slice(1)]),i);const o=s[1];if(o.__impl)return o.__impl.hydrateTree(e,n,s,i);De(r,s);for(let e in o)"o"===e[0]&&"n"===e[1]&&t.setAttrib(r,e,o[e]);for(let n=s.length,i=2;i<n;i++)Be(e,t,r,s[i],i-2)}else if(Le(s))for(let r of s)Be(e,t,n,r,i),i++},we=(e,t,n)=>e?void 0===n?e.appendChild(t):e.insertBefore(t,e.children[n]):t,Pe=(e,t,n,s)=>{if(t.startsWith("__"))return;const i="o"===t[0]&&"n"===t[1];if(i||"function"!=typeof n||(n=n(s)),void 0!==n&&!1!==n)switch(t){case"style":Ce(e,n);break;case"value":$e(e,n);break;case"prefix":e.setAttribute(t,Ue(n)?n:(r=n,Object.keys(r).reduce((e,t)=>(e.push(`${t}: ${r[t]}`),e),[]).join(" ")));break;case"accesskey":e.accessKey=n;break;case"contenteditable":e.contentEditable=n;break;case"tabindex":e.tabIndex=n;break;case"align":case"autocapitalize":case"checked":case"dir":case"draggable":case"hidden":case"id":case"lang":case"namespaceURI":case"scrollTop":case"scrollLeft":case"title":e[t]=n;break;default:i?Me(e,t.substr(2),n):e.setAttribute(t,!0===n?"":n)}else null!=e[t]?e[t]=null:e.removeAttribute(t);var r;return e},$e=(e,t)=>{let n;switch(e.type){case"text":case"textarea":case"password":case"search":case"number":case"email":case"url":case"tel":case"date":case"datetime-local":case"time":case"week":case"month":if(void 0!==(n=e.value)&&"string"==typeof t){const s=t.length-(n.length-(e.selectionStart||0));e.value=t,e.selectionStart=e.selectionEnd=s;break}default:e.value=t}},Ce=(e,t)=>(e.setAttribute("style",(e=>{let t,n="";for(let s in e)t=Ge(e[s]),w(t)&&(t=t(e)),null!=t&&(n+=`${s}:${t};`);return n})(t)),e),Me=(e,t,n)=>Ue(n)?e.setAttribute("on"+t,n):Oe(n)?e.addEventListener(t,...n):e.addEventListener(t,n),xe=(e,t,n)=>Oe(n)?e.removeEventListener(t,...n):e.removeEventListener(t,n),He=Object.getPrototypeOf,je=e=>{let t;return null!=e&&"object"==typeof e&&(null===(t=He(e))||null===He(t))},ke=S(()=>"illegal argument(s)"),ze=e=>{throw new ke(e)},Ye=(e,t)=>{if(null==(t=Ge(t)))return e;if(g(t))return e+" "+t;const n=new Set(e.split(" "));for(let e in t)Ge(t[e])?n.add(e):n.delete(e);return[...n].join(" ")},qe=E,Ve=Ae,We=je,Xe=g,Ke=(e,t,n,s,i,r)=>{if(null!=e){if(qe(e)){if(0===e.length)return;let o,a,l=e[1];if(l&&(a=l.__impl)&&(a=a.normalizeTree))return a(t,e);const c=e[0];if("function"==typeof c)return Ke(c.apply(null,[n,...e.slice(1)]),t,n,s,i,r);if("function"==typeof c.render){const a=[n,...e.slice(1)];return o=Ke(c.render.apply(c,a),t,n,s,i,r),qe(o)&&(o.__this=c,o.__init=c.init,o.__release=c.release,o.__args=a),o}if(o=((e,t)=>{let n,s,i,r,o,a=e[0],l=We(e[1]);if("string"==typeof a&&(n=Te.exec(a))||ze(a+" is not a valid tag name"),s=n[1],a===s&&l&&(!t||e[1].key))return e;o=l?Object.assign({},e[1]):{},i=n[2],r=n[3],i&&(o.id=i);const c=o.class;return r?(r=r.replace(/\./g," "),o.class=c?Ye(r,c):r):c&&(o.class=Xe(c)?c:Ye("",c)),o.__skip&&e.length<3?[s,o]:[s,o,...e.slice(l?2:1)]})(e,i),l=o[1],!1===l.__normalize)return o;if(i&&void 0===l.key&&(l.key=s.join("-")),o.length>2){const e=o[0],a=[e,l];r=r&&!me[e];for(let e=2,l=2,c=0,u=o.length;e<u;e++){let u=o[e];if(null!=u){const e=qe(u);if(e&&qe(u[0])||!e&&Ve(u))for(let e of u)e=Ke(e,t,n,s.concat(c),i,r),void 0!==e&&(a[l++]=e),c++;else u=Ke(u,t,n,s.concat(c),i,r),void 0!==u&&(a[l++]=u),c++}}return a}return o}return"function"==typeof e?Ke(e(n),t,n,s,i,r):"function"==typeof e.toHiccup?Ke(e.toHiccup(t.ctx),t,n,s,i,r):"function"==typeof e.deref?Ke(e.deref(),t,n,s,i,r):r?["span",i?{key:s.join("-")}:{},e.toString()]:e.toString()}},Qe={createTree(e,t,n,s,i){return Fe(e,this,t,n,s,i)},hydrateTree(e,t,n,s){return Be(e,this,t,n,s)},diffTree(e,t,n,s,i){pe(e,this,t,n,s,i)},normalizeTree:(e,t)=>Ke(t,e,e.ctx,[0],!1!==e.keys,!1!==e.span),getElementById:e=>document.getElementById(e),getChild:(e,t)=>e.children[t],createElement:(e,t,n,s)=>{const i=be[t]?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);return n&&((e,t)=>{for(let n in t)Pe(e,n,t[n],t)})(i,n),we(e,i,s)},createTextElement:(e,t,n)=>we(e,document.createTextNode(t),n),replaceChild(e,t,n,s,i){((e,t,n,s,i,r=!0)=>{t.removeChild(n,s),t.createTree(e,n,i,s,r)})(e,this,t,n,s,i)},removeChild:(e,t)=>{const n=e.children[t];void 0!==n&&e.removeChild(n)},setContent:(e,t)=>e.textContent=t,removeAttribs:(e,t,n)=>{for(let s=t.length;--s>=0;){const i=t[s];"o"===i[0]&&"n"===i[1]?xe(e,i.substr(2),n[i]):e.hasAttribute(i)?e.removeAttribute(i):e[i]=null}},setAttrib:Pe};Math.PI,Math.sqrt(5),Math.SQRT2,Math.sqrt(3);let Ze=1e-6;var Je;!function(e){e[e.EQUAL=0]="EQUAL",e[e.FLAT=1]="FLAT",e[e.UNDER=2]="UNDER",e[e.OVER=3]="OVER",e[e.OTHER=4]="OTHER"}(Je||(Je={}));const et=e=>e-Math.floor(e),tt=(e,t,n,s,i,r,o)=>{const a=1/(n-t),l=1/(i-s),c=1/(o-r);return((e,...t)=>{!e&&(e=[]);for(let n=0,s=t.length;n<s;n++)e[n]=t[n];return e})(e||[],2*a,0,0,0,0,2*l,0,0,0,0,-2*c,0,-(t+n)*a,-(i+s)*l,-(o+r)*c,1)};let nt=0;const st=()=>"_s"+(nt++).toString(36);function it(e,t){for(let n of t)e.delete(n);return e}const rt="object"==typeof process&&"object"==typeof process.versions&&void 0!==process.versions.node?n(12).inspect:null,ot=(e,t)=>[...k(e=>rt(e,t),e)].join(", "),at=(e,t)=>[...k(([e,n])=>`${rt(e,t)} => ${rt(n,t)}`,e)].join(", "),lt=h({[Symbol.for("nodejs.util.inspect.custom")](e,t){const n=this[Symbol.toStringTag],s=Object.assign(Object.assign({},t),{depth:null===t.depth?null:t.depth-1});return e>=0?[`${n}(${this.size||0}) {`,rt?this instanceof Set?ot(this,s):this instanceof Map?at(this,s):"":"","}"].join(" "):t.stylize(`[${n}]`,"special")}});var ct;const ut=new WeakMap,dt=e=>ut.get(e).vals;let ft=ct=class extends Set{constructor(e,t={}){super(),ut.set(this,{equiv:t.equiv||Q,vals:[]}),e&&this.into(e)}*[Symbol.iterator](){yield*dt(this)}get[Symbol.species](){return ct}get[Symbol.toStringTag](){return"ArraySet"}get size(){return dt(this).length}copy(){const e=ut.get(this),t=new ct(null,{equiv:e.equiv});return ut.get(t).vals=e.vals.slice(),t}empty(){return new ct(null,this.opts())}clear(){dt(this).length=0}first(){if(this.size)return dt(this)[0]}add(e){return!this.has(e)&&dt(this).push(e),this}into(e){return x(this,e)}has(e){return this.get(e,u)!==u}get(e,t){const n=ut.get(this),s=n.equiv,i=n.vals;for(let t=i.length;--t>=0;)if(s(i[t],e))return i[t];return t}delete(e){const t=ut.get(this),n=t.equiv,s=t.vals;for(let t=s.length;--t>=0;)if(n(s[t],e))return s.splice(t,1),!0;return!1}disj(e){return it(this,e)}equiv(e){return((e,t)=>{if(e===t)return!0;if(!(t instanceof Set)||e.size!==t.size)return!1;for(let n of e.keys())if(!t.has(n))return!1;return!0})(this,e)}forEach(e,t){const n=dt(this);for(let s=n.length;--s>=0;){const i=n[s];e.call(t,i,i,this)}}*entries(){for(let e of dt(this))yield[e,e]}*keys(){yield*dt(this)}*values(){yield*dt(this)}opts(){return{equiv:ut.get(this).equiv}}};var ht;ft=ct=c([lt],ft);const pt=new WeakMap,_t=e=>pt.get(e).map;let Et=ht=class extends Map{constructor(e,t){super();const n=Object.assign({equiv:Q,keys:ft},t);pt.set(this,{keys:new n.keys(null,{equiv:n.equiv}),map:new Map,opts:n}),e&&this.into(e)}[Symbol.iterator](){return this.entries()}get[Symbol.species](){return ht}get[Symbol.toStringTag](){return"EquivMap"}get size(){return pt.get(this).keys.size}clear(){const e=pt.get(this);e.keys.clear(),e.map.clear()}empty(){return new ht(null,pt.get(this).opts)}copy(){const e=pt.get(this),t=new ht;return pt.set(t,{keys:e.keys.copy(),map:new Map(e.map),opts:e.opts}),t}equiv(e){return((e,t)=>{if(e===t)return!0;if(!(t instanceof Map)||e.size!==t.size)return!1;for(let n of e.entries())if(!Q(t.get(n[0]),n[1]))return!1;return!0})(this,e)}delete(e){const t=pt.get(this);return(e=t.keys.get(e,u))!==u&&(t.map.delete(e),t.keys.delete(e),!0)}dissoc(e){return it(this,e)}forEach(e,t){for(let n of _t(this))e.call(t,n[1],n[0],this)}get(e,t){const n=pt.get(this);return(e=n.keys.get(e,u))!==u?n.map.get(e):t}has(e){return pt.get(this).keys.has(e)}set(e,t){const n=pt.get(this),s=n.keys.get(e,u);return s!==u?n.map.set(s,t):(n.keys.add(e),n.map.set(e,t)),this}into(e){return x(this,e)}entries(){return _t(this).entries()}keys(){return _t(this).keys()}values(){return _t(this).values()}opts(){return pt.get(this).opts}};Et=ht=c([lt],Et);const gt=(e,t,n)=>{if(e.size<t.size){const n=e;e=t,t=n}var s,i;return n=n?x(n,e):(s=e,i=Set,y(s,"copy")?s.copy():new(s[Symbol.species]||i)(s)),e===t?n:x(n,t)};class Rt{constructor(e){if(this.dependencies=new Et,this.dependents=new Et,e)for(let[t,n]of e)this.addDependency(t,n)}*[Symbol.iterator](){yield*this.sort()}get[Symbol.species](){return Rt}copy(){const e=new Rt;for(let t of this.dependencies)e.dependencies.set(t[0],t[1].copy());for(let t of this.dependents)e.dependents.set(t[0],t[1].copy());return e}addNode(e){return!this.dependencies.has(e)&&this.dependencies.set(e,new ft),this}addDependency(e,t){(Q(e,t)||this.depends(t,e))&&ze(`Circular dependency between: ${e} & ${t}`);let n=this.dependencies.get(e);return this.dependencies.set(e,n?n.add(t):new ft([t])),n=this.dependents.get(t),this.dependents.set(t,n?n.add(e):new ft([e])),this}addDependencies(e,t){for(let n of t)this.addDependency(e,n)}removeEdge(e,t){let n=this.dependencies.get(e);return n&&n.delete(t),n=this.dependents.get(t),n&&n.delete(e),this}removeNode(e){return this.dependencies.delete(e),this}depends(e,t){return this.transitiveDependencies(e).has(t)}dependent(e,t){return this.transitiveDependents(e).has(t)}immediateDependencies(e){return this.dependencies.get(e)||new ft}immediateDependents(e){return this.dependents.get(e)||new ft}isLeaf(e){return 0===this.immediateDependents(e).size}isRoot(e){return 0===this.immediateDependencies(e).size}nodes(){return gt(new ft(this.dependencies.keys()),new ft(this.dependents.keys()))}leaves(){return B(e=>this.isLeaf(e),this.nodes())}roots(){return B(e=>this.isRoot(e),this.nodes())}transitiveDependencies(e){return It(this.dependencies,e)}transitiveDependents(e){return It(this.dependents,e)}sort(){const e=[],t=this.copy();let n=new ft(t.leaves());for(;;){if(!n.size)return e.reverse();const s=n.first();n.delete(s);for(let e of[...t.immediateDependencies(s)])t.removeEdge(s,e),t.isLeaf(e)&&n.add(e);e.push(s),t.removeNode(s)}}}const It=(e,t)=>{const n=e.get(t);return n?O(D(null,(t,n)=>gt(t,It(e,n))),n,n):new ft},Nt=/^[iub]?vec[234]$/,yt=/^mat[234]$/,vt=e=>Nt.test(e.type),At=e=>yt.test(e.type),Tt=e=>"fn"===e.tag||"for"===e.tag||"while"==e.tag?e.scope.body:"if"===e.tag?e.f?e.t.body.concat(e.f.body):e.t.body:void 0,mt=e=>Tt(e)||("scope"===e.tag?e.body:"ternary"===e.tag?[e.t,e.f]:"ret"===e.tag?[e.val]:"call"===e.tag||"call_i"===e.tag?e.args:"sym"===e.tag&&e.init?[e.init]:"decl"===e.tag?[e.id]:"op1"===e.tag||"swizzle"===e.tag?[e.val]:"op2"===e.tag?[e.l,e.r]:"assign"===e.tag?[e.r]:vt(e)||At(e)||(e=>je(e)&&!!e.tag&&!!e.type)(e.val)?e.val:void 0),St=(e,t,n,s,i=!0)=>{if(E(s))s.forEach(s=>n=St(e,t,n,s,i));else{i&&(n=e(n,s));const r=t(s);r&&(n=St(e,t,n,r,i)),!i&&(n=e(n,s))}return n},bt=(e,t=new Rt)=>e.deps&&e.deps.length?e.deps.reduce((t,n)=>bt(n,t.addDependency(e,n)),t):t.addNode(e),Gt=(e,t=!1)=>({tag:"scope",type:"void",body:e.filter(e=>null!=e).map(e=>{return"sym"===e.tag?{tag:"decl",type:(t=e).type,id:t}:e;var t}),global:t});function Ot(e,...t){let n,s,i;switch(t.length){case 0:g(e)||(i=e,e=i.type);break;case 1:g(t[0])?n=t[0]:t[0].tag?i=t[0]:s=t[0];break;case 2:g(t[0])?[n,s]=t:[s,i]=t;break;case 3:[n,s,i]=t;break;default:ze()}return{tag:"sym",type:e,id:n||st(),opts:s||{},init:i}}const Lt=(e,t,n)=>Ot(e,t,Object.assign({q:"in",type:"in"},n)),Ut=(e,t,n)=>Ot(e,t,Object.assign({q:"out",type:"out"},n)),Dt=(e,t,n)=>Ot(e,t,Object.assign({q:"in",type:"uni"},n)),Ft=e=>{const[t,n,s]=g(e)?[e]:e;return{tag:"arg",type:t,id:n||st(),opts:Object.assign({q:"in"},s)}};const Bt=e=>function(e,t,n,s){const i=n.map(Ft),r=s(...i.map(e=>Ot(e.type,e.id,e.opts))).filter(e=>null!=e),o=St((n,s)=>("ret"===s.tag&&(f(s.type===e,`wrong return type for function '${t}', expected ${e}, got ${s.type}`),n++),n),Tt,0,r);if("void"!==e&&!o)throw new Error(`function '${t}' must return a value of type ${e}`);const a=St((e,t)=>("call"===t.tag&&t.fn&&e.push(t.fn),e),mt,[],r),l=(...e)=>function(e,...t){return g(e)?{tag:"call",type:t[0],id:e,args:t.slice(1)}:{tag:"call",type:e.type,id:e.id,args:t,fn:e}}(l,...e);return Object.assign(l,{tag:"fn",type:e,id:t,args:i,deps:a,scope:Gt(r)})}("void","main",[],e),wt=(e,t,...n)=>({tag:"call_i",type:t,id:e,args:n}),Pt=(e,t)=>(f("swizzle"!==e.tag||"sym"===e.val.tag,"can't assign to non-symbol swizzle"),{tag:"assign",type:e.type,l:e,r:t}),$t=e=>"number"==typeof e,Ct=e=>"boolean"==typeof e,Mt=(e,t,n)=>({tag:"lit",type:e,info:n,val:t}),xt=e=>Mt("bool",$t(e)?!!e:e),Ht=e=>Mt("float",Ct(e)?1&e:e),jt=e=>Mt("int",Ct(e)?1&e:$t(e)?0|e:e),kt=e=>Mt("uint",Ct(e)?1&e:$t(e)?e>>>0:e),zt=(e,t)=>n=>$t(n)?t(n):void 0===n||vt(n)||n.type===e?n:t(n),Yt=zt("float",Ht),qt=zt("int",jt),Vt=zt("uint",kt),Wt=zt("bool",xt),Xt=(xt(!0),xt(!1)),Kt=Ht(0),Qt=(Ht(1),Ht(2),Ht(.5),jt(0)),Zt=(jt(1),kt(0)),Jt=(kt(1),Ht(Math.PI),Ht(2*Math.PI),Ht(Math.PI/2),Ht(Math.SQRT2),(e,t)=>n=>[void 0===n[0]?t:e(n[0]),...n.slice(1).map(e)]),en=Jt(Yt,Kt),tn=(Jt(qt,Qt),Jt(Vt,Zt),Jt(Wt,Xt),(e,t)=>vt(e[0])?e[0].type[0]:t[e.length]);function nn(...e){return((e,t,n)=>Mt(e,n=t(n),2===n.length?vt(n[1])?"vv":"vn":tn(n,["n","n",,"vnn"])))("vec4",en,e)}const sn=(e,t)=>{const n=e.type[0];return"i"===n?jt(t):"u"===n?kt(t):"b"===n?xt(t):Ht(t)},rn=e=>t=>wt(e,t.type,t),on=e=>(t,n)=>wt(e,t.type,t,n),an=e=>(t,n,s)=>wt(e,t.type,t,n,s);function ln(e,t,n){const s=wt("mix",e.type,e,t,n);return"float"===n.type&&(s.info="n"),s}on("min"),on("max"),an("clamp"),on("step"),an("smoothstep"),rn("radians"),rn("degrees"),rn("cos"),rn("sin"),rn("tan"),rn("acos"),rn("asin"),on("pow"),rn("exp"),rn("log"),rn("exp2"),rn("log2"),rn("sqrt"),rn("inversesqrt"),rn("abs"),rn("sign"),rn("floor"),rn("ceil"),rn("fract");const cn={mave:"mv",vema:"vm",vefl:"vn",mafl:"vn",flve:"nv",flma:"nv",ivin:"vn",iniv:"nv",uvui:"vn",uiuv:"nv"},un=(e,t,n,s,i)=>{const r=$t(t),o=$t(n);let a,l,c;return r?o?(l=Ht(t),c=Ht(n),a="float"):(c=n,l=sn(c,t),a=c.type):o?(l=t,c=sn(l,n),a=l.type):(l=t,c=n,a=s||(vt(l)?l.type:vt(c)||At(c)?c.type:l.type)),{tag:"op2",type:s||a,info:i||cn[l.type.substr(0,2)+c.type.substr(0,2)],op:e,l,r:c}};function dn(e,t){return un("*",e,t,!$t(e)&&!$t(t)&&At(e)&&vt(t)?t.type:void 0)}const fn=e=>(t,n)=>un(e,t,n,"bool");function hn(e,t){const n=e.type[0],s=(e,n)=>1===t.length?e:n+t.length;return{tag:"swizzle",type:"i"===n?s("int","ivec"):"u"===n?s("uint","uvec"):"b"===n?s("bool","bvec"):s("float","vec"),val:e,id:t}}fn("=="),fn("!="),fn("<"),fn("<="),fn(">"),fn(">=");const pn=Math.random,_n=new class extends class{float(e=1){return this.int()*(1/4294967295)*e}norm(e=1){return 2*(this.int()*(1/4294967295)-.5)*e}minmax(e,t){return this.float()*(t-e)+e}gaussian(e=10,t=-.5,n=1){let s=0,i=e;for(;i-- >0;)s+=this.float(n);return s/e+t}}{int(){return 4294967295*pn()>>>0}float(e=1){return pn()*e}norm(e=1){return 2*(pn()-.5)*e}};function En(e,t,n){return new gn(e,t,n)}class gn{constructor(e,t,n){void 0===e?(e=0,t=1/0):void 0===t&&(t=e,e=0),n=void 0===n?e<t?1:-1:n,this.from=e,this.to=t,this.step=n}*[Symbol.iterator](){const e=this.step,t=this.to;let n=this.from;if(e>0)for(;n<t;)yield n,n+=e;else if(e<0)for(;n>t;)yield n,n+=e}$reduce(e,t){const n=this.step;if(n>0)for(let s=this.from,i=this.to;s<i&&!T(t);s+=n)t=e(t,s);else for(let s=this.from,i=this.to;s>i&&!T(t);s+=n)t=e(t,s);return t}}function Rn(...e){let[t,n,s,i,r,o,a,l,c,u]=e;switch(e.length){case 0:G(0);case 1:return t;case 2:return(...e)=>t(n(...e));case 3:return(...e)=>t(n(s(...e)));case 4:return(...e)=>t(n(s(i(...e))));case 5:return(...e)=>t(n(s(i(r(...e)))));case 6:return(...e)=>t(n(s(i(r(o(...e))))));case 7:return(...e)=>t(n(s(i(r(o(a(...e)))))));case 8:return(...e)=>t(n(s(i(r(o(a(l(...e))))))));case 9:return(...e)=>t(n(s(i(r(o(a(l(c(...e)))))))));case 10:default:const d=(...e)=>t(n(s(i(r(o(a(l(c(u(...e))))))))));return 10===e.length?d:Rn(d,...e.slice(10))}}function In(...e){return e=e.map(v),Rn.apply(null,e)}function Nn(e,t){return I(t)?function*(e,t){const n=v(e)(D(()=>[],(e,t)=>(e.push(t),e))),s=n[1],i=n[2];for(let e of t){const t=i([],e);if(T(t))return void(yield*m(s(t.deref())));t.length&&(yield*t)}yield*m(s([]))}(Nn(e),t):t=>{const n=t[2];let s=e;return N(t,(e,t)=>--s>0?n(e,t):0===s?(e=>e instanceof A?e:new A(e))(n(e,t)):(e=>new A(e))(e))}}function yn(...e){return((e,t,n=F)=>{const s=t.length-1;return I(t[s])?t.length>1?n(e.apply(null,t.slice(0,s)),t[s]):n(e(),t[0]):void 0})(yn,e)||(t=>{const n=t[2],s=e[0];let i=e[1]||0;return N(t,(e,t)=>n(e,s(i++,t)))})}function vn(e,t){e=e||"";let n=!0;return t?[...t].join(e):D(()=>"",(t,s)=>(t=n?t+s:t+e+s,n=!1,t))}function*An(...e){const t=e.map(e=>e[Symbol.iterator]());for(;;){const e=[];for(let n of t){let t=n.next();if(t.done)return;e.push(t.value)}yield e}}const Tn=e=>([t,n,s])=>`${t}=${n}${e}${s};`,mn=e=>([t,n])=>`${t}=${n}${e}n;`,Sn=([e,t])=>`${e}*${t}`,bn=([e,t])=>`${e}=${t};`,Gn=([e,t,n])=>`${e}=${t}+(${n}-${t})*n;`,On=S(()=>"unsupported operation"),Ln=e=>{throw new On(e)},Un=(e=0)=>{const t=new Array(5);let n;const s=(...s)=>{const i=t[s[e].length]||n;return i?i(...s):Ln("no impl for vec size "+s[e].length)};return s.add=(e,n)=>t[e]=n,s.default=e=>n=e,s.impl=e=>t[e]||n,s},Dn="io=0,ia=0,so=1,sa=1",Fn="io=0,ia=0,ib=0,so=1,sa=1,sb=1",Bn=e=>k((e=>t=>t>1?`${e}[i${e}+${t}*s${e}]`:1==t?`${e}[i${e}+s${e}]`:`${e}[i${e}]`)(e),En()),wn=e=>k(t=>`${e}[${t}]`,En()),Pn=(e,t,n,s="a",i="",r="",o="",a=!1)=>[r,z(In(Nn(e),yn((e,n)=>t(n,e))),vn(i),An.apply(null,n.split(",").map(a?Bn:wn))),o,""!==s?`return ${s};`:""],$n=(e,t,n="a",s,i,r=!1)=>[s,"for(let i=a.length;--i>=0;) {",e(t.split(",").map(r?e=>`${e}[i${e}+i*s${e}]`:e=>e+"[i]")),"}",i,null!==n?`return ${n};`:""],Cn=(e,t)=>`!${e} && (${e}=${t.split(",")[1]});`,Mn=(e,t,n,s=n,i="a",r,o,a,l=!1)=>new Function(n,Pn(e,t,s,i,r,o,a,l).join("")),xn=(e,t,n,s,i,r=i,o="a",a="",l,c,u=!1)=>new Function(s,`return (${i})=>{${Pn(e,n,r,o,a,l,c,u).join("")}}`)(...t),Hn=(e,t,n=t,s="a",i,r,o=!1)=>new Function(t,$n(e,n,s,i,r,o).join("")),jn=(e,t="o,a,b",n,s="o",i=1,r)=>{n=n||t,r=null!=r?r:Cn(s,t);const o=Un(i),a=i=>o.add(i,Mn(i,e,t,n,s,"",r));return o.default(Hn(e,t,n,s,r)),[o,a(2),a(3),a(4)]},kn=(e,t,n="o,a",s,i="o",r=1,o)=>{const a=t||((e="op")=>([t,n])=>`${t}=${e}(${n});`)("op");s=s||n,o=null!=o?o:Cn(i,n);const l=t=>xn(t,[e],a,"op",n,s,i,"",o),c=Un(r);return c.default(((e,t,n,s,i=s,r="a",o,a,l=!1)=>new Function("op",`return (${s})=>{${$n(t,i,r,o,void 0,l).join("")}}`)(...e))([e],a,0,n,s,i,o)),[c,l(2),l(3),l(4)]},zn=(e,t="o,a,b,"+Fn,n="o,a,b",s="o",i,r=[2,3,4])=>r.map(r=>Mn(r,e,t,n,s,"",null!=i?i:Cn(s,t),"",!0)),Yn=(e,t,n="o,a,b,"+Fn,s="o,a,b",i="o",r,o=[2,3,4])=>o.map(o=>xn(o,[e],t,"op",n,s,i,"",null!=r?r:Cn(i,n),"",!0)),qn=e=>Mn(e,Sn,"o,a,"+Dn,"o,a","","+","return ",";",!0),Vn=qn(2),Wn=qn(3),Xn=qn(4),[Kn,Qn,Zn]=zn(mn("*"),"o,a,n,"+Dn,"o,a"),[Jn,es,ts]=zn(bn,"o,a,"+Dn,"o,a","o","!o&&(o=[]);"),ns=(e,t,n=1,s=0,i=0,r=1,o=1)=>{!e&&(e=t);const a=((e,t,n)=>Math.sqrt(Vn(e,e,t,t,n,n)))(t,i,o);return a>=Ze?Kn(e,t,n/a,s,i,r,o):e!==t?Jn(e,t,s,i,r,o):e},[ss,is,rs]=Yn(_n,([e])=>e+"=rnd.minmax(n,m);","a,n=-1,m=1,rnd=op,ia=0,sa=1","a","a","!a && (a=[]);"),os=(e,t)=>(n,s=1,i,r=0,o=1)=>e(n=t(n,-1,1,i,r,o),n,s,r,r,o,o),as=os(ns,ss),[ls,cs,us]=(os((e,t,n=1,s=0,i=0,r=1,o=1)=>{!e&&(e=t);const a=((e,t,n)=>Math.sqrt(Wn(e,e,t,t,n,n)))(t,i,o);return a>=Ze?Qn(e,t,n/a,s,i,r,o):e!==t?es(e,t,s,i,r,o):e},is),os((e,t,n=1,s=0,i=0,r=1,o=1)=>{!e&&(e=t);const a=((e,t,n)=>Math.sqrt(Xn(e,e,t,t,n,n)))(t,i,o);return a>=Ze?Zn(e,t,n/a,s,i,r,o):e!==t?ts(e,t,s,i,r,o):e},rs),Yn(_n,([e,t,n])=>`${e}=rnd.minmax(${t},${n});`,"o,a,b,rnd=op,"+Fn,"o,a,b")),ds=(e,t,n)=>(s,i,r,o=0,a=0,l=1,c=1)=>{s?s!==i&&e(s,i,o,a,l,c):s=i;const u=Math.sin(r),d=Math.cos(r),f=i[a+t*c],h=i[a+n*c];return s[o+t*l]=f*d-h*u,s[o+n*l]=f*u+h*d,s},fs=ds(Jn,0,1),[hs,ps,_s]=(ds(es,1,2),ds(es,2,0),ds(es,0,1),zn(Gn,"o,a,b,n,"+Fn)),[Es,gs,Rs]=zn(Tn("+")),Is=e=>Ns.add(e,Mn(e,([e])=>`${e}*${e}`,"a","a","","+","return ",";")),Ns=Un();Ns.default(Hn(([e])=>`sum+=${e}*${e};`,"a",void 0,"sum","let sum=0;")),Is(2),Is(3),Is(4);const[ys,vs,As,Ts]=jn(bn,"o,a",void 0,"o",1,"!o&&(o=[]);"),ms=(e,t)=>(n,s,i)=>{n?n!==s&&ys(n,s):n=s;const r=Math.sin(i),o=Math.cos(i),a=s[e],l=s[t];return n[e]=a*o-l*r,n[t]=a*r+l*o,n},[Ss,bs,Gs,Os]=(ms(1,2),ms(2,0),ms(0,1),jn(mn("*"),"o,a,n")),[Ls,Us,Ds,Fs]=jn(Gn,"o,a,b,n"),[Bs,ws,Ps,$s]=kn(_n,([e])=>e+"=rnd.minmax(n,m);","a,n=-1,m=1,rnd=op","a","a",0,"!a && (a=[]);"),[Cs,Ms,xs,Hs]=kn(_n,([e,t,n])=>`${e}=rnd.minmax(${t},${n});`,"o,a,b,rnd=op","o,a,b"),[js,ks,zs,Ys]=jn(Tn("+")),qs=(e,t,n)=>((e,t,n,s,i)=>(!e&&(e=[]),e[0]=t,e[1]=n,e[2]=s,e[3]=i,e))(e,t[0],t[1],t[2],n);var Vs,Ws;!function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(Vs||(Vs={})),function(e){e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.MAX=32776]="MAX",e[e.MIN=32775]="MIN"}(Ws||(Ws={})),Vs.SRC_ALPHA,Vs.ONE_MINUS_SRC_ALPHA;const Xs=[Vs.SRC_ALPHA,Vs.DST_ALPHA];var Ks,Qs,Zs,Js,ei,ti;!function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Ks||(Ks={})),function(e){e[e.ALPHA=6406]="ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.R16F=33325]="R16F",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32F=33326]="R32F",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.R8=33321]="R8",e[e.R8_SNORM=36756]="R8_SNORM",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.RED=6403]="RED",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RG16F=33327]="RG16F",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32F=33328]="RG32F",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RG8=33323]="RG8",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RGB=6407]="RGB",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB16I=36233]="RGB16I",e[e.RGB16UI=36215]="RGB16UI",e[e.RGB32F=34837]="RGB32F",e[e.RGB32I=36227]="RGB32I",e[e.RGB32UI=36209]="RGB32UI",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.RGB8=32849]="RGB8",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGB8I=36239]="RGB8I",e[e.RGB8UI=36221]="RGB8UI",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA=6408]="RGBA",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGBA16F=34842]="RGBA16F",e[e.RGBA16I=36232]="RGBA16I",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGBA32F=34836]="RGBA32F",e[e.RGBA32I=36226]="RGBA32I",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGBA4=32854]="RGBA4",e[e.RGBA8=32856]="RGBA8",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGBA8I=36238]="RGBA8I",e[e.RGBA8UI=36220]="RGBA8UI",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8"}(Qs||(Qs={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Zs||(Zs={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Js||(Js={})),function(e){e[e.LINEAR=9729]="LINEAR",e[e.NEAREST=9728]="NEAREST",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(ei||(ei={})),function(e){e[e.REPEAT=10497]="REPEAT",e[e.CLAMP=33071]="CLAMP",e[e.REPEAT_MIRROR=33648]="REPEAT_MIRROR"}(ti||(ti={}));const ni=(e,t,n,s=!1,i=!1,r=s)=>({format:e,types:t,render:s,renderExt:r,filter:i,num:n}),si=(Qs.ALPHA,ni(Qs.ALPHA,[Zs.UNSIGNED_BYTE,1,Zs.HALF_FLOAT,2,Zs.HALF_FLOAT_OES,2,Zs.FLOAT,4],1,!0,!0),Qs.DEPTH_COMPONENT,ni(Qs.DEPTH_COMPONENT,[Zs.UNSIGNED_SHORT,2,Zs.UNSIGNED_INT,4],1,!0),Qs.DEPTH_COMPONENT16,ni(Qs.DEPTH_COMPONENT,[Zs.UNSIGNED_SHORT,2,Zs.UNSIGNED_INT,4],1,!0),Qs.DEPTH_COMPONENT24,ni(Qs.DEPTH_COMPONENT,[Zs.UNSIGNED_INT,4],1,!0),Qs.DEPTH_COMPONENT32F,ni(Qs.DEPTH_COMPONENT,[Zs.FLOAT,4],1,!0),Qs.DEPTH_STENCIL,ni(Qs.DEPTH_STENCIL,[Zs.UNSIGNED_INT_24_8,4],1,!0),Qs.DEPTH24_STENCIL8,ni(Qs.DEPTH_STENCIL,[Zs.UNSIGNED_INT_24_8,4],1,!0),Qs.DEPTH32F_STENCIL8,ni(Qs.DEPTH_STENCIL,[Zs.FLOAT_32_UNSIGNED_INT_24_8_REV,4],1,!0),Qs.LUMINANCE_ALPHA,ni(Qs.LUMINANCE_ALPHA,[Zs.UNSIGNED_BYTE,2,Zs.HALF_FLOAT,4,Zs.HALF_FLOAT_OES,4,Zs.FLOAT,8],2,!0,!0),Qs.LUMINANCE,ni(Qs.LUMINANCE,[Zs.UNSIGNED_BYTE,1,Zs.HALF_FLOAT,2,Zs.HALF_FLOAT_OES,2,Zs.FLOAT,4],1,!0,!0),Qs.R11F_G11F_B10F,ni(Qs.RGB,[Zs.FLOAT,12,Zs.HALF_FLOAT,6,Zs.UNSIGNED_INT_10F_11F_11F_REV,4],3,!1,!0,!0),Qs.R16F,ni(Qs.RED,[Zs.FLOAT,4,Zs.HALF_FLOAT,2],1,!1,!0,!0),Qs.R16I,ni(Qs.RED_INTEGER,[Zs.SHORT,2],1,!0),Qs.R16UI,ni(Qs.RED_INTEGER,[Zs.UNSIGNED_SHORT,2],1,!0),Qs.R32F,ni(Qs.RED,[Zs.FLOAT,4],1,!1,!1,!0),Qs.R32I,ni(Qs.RED_INTEGER,[Zs.INT,4],1,!0),Qs.R32UI,ni(Qs.RED_INTEGER,[Zs.UNSIGNED_INT,4],1,!0),Qs.R8_SNORM,ni(Qs.RED,[Zs.BYTE,1],1,!1,!0),Qs.R8,ni(Qs.RED,[Zs.UNSIGNED_BYTE,1],1,!0,!0),Qs.R8I,ni(Qs.RED_INTEGER,[Zs.BYTE,1],1,!0),Qs.R8UI,ni(Qs.RED_INTEGER,[Zs.UNSIGNED_BYTE,1],1,!0),Qs.RG16F,ni(Qs.RG,[Zs.FLOAT,8,Zs.HALF_FLOAT,4],2,!1,!0,!0),Qs.RG16I,ni(Qs.RG_INTEGER,[Zs.SHORT,4],2,!0),Qs.RG16UI,ni(Qs.RG_INTEGER,[Zs.UNSIGNED_SHORT,4],2,!0),Qs.RG32F,ni(Qs.RG,[Zs.FLOAT,8],2,!1,!1,!0),Qs.RG32I,ni(Qs.RG_INTEGER,[Zs.INT,8],2,!0),Qs.RG32UI,ni(Qs.RG_INTEGER,[Zs.UNSIGNED_INT,8],2,!0),Qs.RG8_SNORM,ni(Qs.RG,[Zs.BYTE,2],2,!1,!0),Qs.RG8,ni(Qs.RG,[Zs.UNSIGNED_BYTE,2],2,!0,!0),Qs.RG8I,ni(Qs.RG_INTEGER,[Zs.BYTE,2],2,!0),Qs.RG8UI,ni(Qs.RG_INTEGER,[Zs.UNSIGNED_BYTE,2],2,!0),Qs.RGB,ni(Qs.RGB,[Zs.UNSIGNED_BYTE,3,Zs.HALF_FLOAT,6,Zs.HALF_FLOAT_OES,6,Zs.FLOAT,12,Zs.UNSIGNED_SHORT_5_6_5,2],3,!0,!0),Qs.RGB10_A2,ni(Qs.RGBA,[Zs.UNSIGNED_INT_2_10_10_10_REV,4],4,!0,!0),Qs.RGB10_A2UI,ni(Qs.RGBA_INTEGER,[Zs.UNSIGNED_INT_2_10_10_10_REV,4],4,!0),Qs.RGB16F,ni(Qs.RGB,[Zs.FLOAT,12,Zs.HALF_FLOAT,6],3,!1,!0),Qs.RGB16I,ni(Qs.RGB_INTEGER,[Zs.SHORT,6],3),Qs.RGB16UI,ni(Qs.RGB_INTEGER,[Zs.UNSIGNED_SHORT,6],3),Qs.RGB32F,ni(Qs.RGB,[Zs.FLOAT,12],3),Qs.RGB32I,ni(Qs.RGB_INTEGER,[Zs.INT,12],3),Qs.RGB32UI,ni(Qs.RGB_INTEGER,[Zs.UNSIGNED_INT,12],3),Qs.RGB5_A1,ni(Qs.RGBA,[Zs.UNSIGNED_BYTE,4,Zs.UNSIGNED_SHORT_5_5_5_1,2,Zs.UNSIGNED_INT_2_10_10_10_REV,4],4,!0,!0),Qs.RGB565,ni(Qs.RGB,[Zs.UNSIGNED_BYTE,3,Zs.UNSIGNED_SHORT_5_6_5,2],3,!0,!0),Qs.RGB8_SNORM,ni(Qs.RGB,[Zs.BYTE,3],3,!1,!0),Qs.RGB8,ni(Qs.RGB,[Zs.UNSIGNED_BYTE,3],3,!0,!0),Qs.RGB8I,ni(Qs.RGB_INTEGER,[Zs.BYTE,3],3),Qs.RGB8UI,ni(Qs.RGB_INTEGER,[Zs.UNSIGNED_BYTE,3],3),Qs.RGB9_E5,ni(Qs.RGB,[Zs.FLOAT,12,Zs.HALF_FLOAT,6,Zs.UNSIGNED_INT_5_9_9_9_REV,4],3,!1,!0),Qs.RGBA,ni(Qs.RGBA,[Zs.UNSIGNED_BYTE,4,Zs.HALF_FLOAT,8,Zs.HALF_FLOAT_OES,8,Zs.FLOAT,16,Zs.UNSIGNED_SHORT_4_4_4_4,2,Zs.UNSIGNED_SHORT_5_5_5_1,2],4,!0,!0),Qs.RGBA16F,ni(Qs.RGBA,[Zs.FLOAT,16,Zs.HALF_FLOAT,8],4,!1,!0,!0),Qs.RGBA16I,ni(Qs.RGBA_INTEGER,[Zs.SHORT,8],4,!0),Qs.RGBA16UI,ni(Qs.RGBA_INTEGER,[Zs.UNSIGNED_SHORT,8],4,!0),Qs.RGBA32F,ni(Qs.RGBA,[Zs.FLOAT,16],4,!1,!1,!0),Qs.RGBA32I,ni(Qs.RGBA_INTEGER,[Zs.INT,16],4,!0),Qs.RGBA32UI,ni(Qs.RGBA_INTEGER,[Zs.UNSIGNED_INT,16],4,!0),Qs.RGBA4,ni(Qs.RGBA,[Zs.UNSIGNED_BYTE,4,Zs.UNSIGNED_SHORT_4_4_4_4,2],4,!0,!0),Qs.RGBA8_SNORM,ni(Qs.RGBA,[Zs.BYTE,4],4,!1,!0),Qs.RGBA8,ni(Qs.RGBA,[Zs.UNSIGNED_BYTE,4],4,!0,!0),Qs.RGBA8I,ni(Qs.RGBA_INTEGER,[Zs.BYTE,4],4,!0),Qs.RGBA8UI,ni(Qs.RGBA_INTEGER,[Zs.UNSIGNED_BYTE,4],4,!0),Qs.SRGB8_ALPHA8,ni(Qs.RGBA,[Zs.UNSIGNED_BYTE,4],4,!0,!0),Qs.SRGB8,ni(Qs.RGB,[Zs.UNSIGNED_BYTE,3],3,!1,!0),e=>"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext);class ii extends Error{constructor(e){super("WebGL error "+(e?": "+e:""))}}const ri=e=>{throw new ii(e)};class oi{constructor(e,t,n=e.ARRAY_BUFFER,s=e.STATIC_DRAW){this.gl=e,this.buffer=e.createBuffer()||ri("error creating WebGL buffer"),this.target=n,this.mode=s,t&&this.set(t)}bind(){return this.gl.bindBuffer(this.target,this.buffer),!0}unbind(){return this.gl.bindBuffer(this.target,null),!0}release(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),delete this.buffer),!0}set(e,t=this.mode){this.bind(),this.gl.bufferData(this.target,e,t)}setChunk(e,t=0){this.bind(),this.gl.bufferSubData(this.target,t,e)}}const ai=(e,t,n,s)=>{t.buffer?t.data&&t.buffer.set(t.data):t.buffer=new oi(e,t.data,n,s)},li=(e,t,n)=>{if(t)for(let s in t)ai(e,t[s],e.ARRAY_BUFFER,n);return t},ci=e=>null!=e;var ui,di;!function(e){e.GLES_100="100",e.GLES_300="300 es"}(ui||(ui={})),function(e){e[e.FINE=0]="FINE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.SEVERE=4]="SEVERE",e[e.NONE=5]="NONE"}(di||(di={}));const fi=Object.freeze({level:di.NONE,fine(){},debug(){},info(){},warn(){},severe(){}}),hi=Symbol();let pi=fi;const _i=(e,t,n)=>{const s=t[n];if(s)for(let n of s){let s=e[n]||_i(e,t,n);if(s)return s}},Ei=(e,t,n)=>{const s=t[n];if(s)for(let n of s)e.push(n),Ei(e,t,n);return e},gi=e=>{const t=function(e,t){const n={},s={},i=(...t)=>{const i=e(...t),r=n[i]||_i(n,s,i)||n[hi];return r?r(...t):Ln(`missing implementation for: "${i.toString()}"`)};return i.add=(e,t)=>(n[e]&&pi.warn(`overwriting '${e.toString()}' impl`),n[e]=t,!0),i.addAll=e=>{let t=!0;for(let n in e)t=i.add(n,e[n])&&t;return t},i.remove=e=>!!n[e]&&(delete n[e],!0),i.callable=(...t)=>{const i=e(...t);return!!(n[i]||_i(n,s,i)||n[hi])},i.isa=(e,t)=>{let n=s[e];!n&&(s[e]=n=new Set),n.add(t)},i.impls=()=>{const e=new Set(Object.keys(n));for(let t in s)_i(n,s,t)&&e.add(t);return n[hi]&&e.add(hi),e},i.rels=()=>s,i.parents=e=>s[e],i.ancestors=e=>new Set(Ei([],s,e)),i}(e=>e.tag);return t.add(hi,e=>Ln(`no impl for AST node type: '${e.tag}'`)),t.addAll(e),t},Ri=/[};]$/;function*Ii(e){for(let t in e)e.hasOwnProperty(t)&&(yield e[t])}const Ni={WEBGL_draw_buffers:{gl:!0,alias:"GL_EXT_draw_buffers"},OES_standard_derivatives:{gl:!0,alias:"GL_OES_standard_derivatives"}};let yi=fi;const vi={fragColor:["vec4",0]},Ai=(e,t,n=!0)=>{const s={};if(t)for(let i of t)s[i]=e.getExtension(i),n&&!s[i]&&ri(`extension ${i} not available`);return s},Ti={a:"",v:"",u:"",o:""},mi={[ui.GLES_100]:{number:100,attrib:(e,t,n)=>`attribute ${E(t)?t[0]:t} ${n.a}${e};`,varying:{vs:(e,t,n)=>Si("varying",t,n.v+e),fs:(e,t,n)=>Si("varying",t,n.v+e)},uniform:(e,t,n)=>Si("uniform",t,n.u+e),output:(e,t,n)=>E(t)?`#define ${n.o}${e} gl_FragData[${t[1]}]`:""},[ui.GLES_300]:{number:300,attrib:(e,t,n)=>E(t)?`layout(location=${t[1]}) in ${t[0]} ${n.a}${e};`:`in ${t} ${n.a}${e};`,varying:{vs:(e,t,n)=>Si("out",t,n.v+e),fs:(e,t,n)=>Si("in",t,n.v+e)},uniform:(e,t,n)=>Si("uniform",t,n.u+e),output:(e,t,n)=>E(t)?`layout(location=${t[1]}) out ${t[0]} ${n.o}${e};`:`out ${t} ${n.o}${e};`}},Si=(e,t,n)=>{const s=E(t)?t[0]:t;return s.indexOf("[]")>0?`${e} ${s.replace("[]","")} ${n}[${t[1]}];`:`${e} ${s} ${n};`},bi=(((e,t,n="")=>{let s=">=";t||(t=n,n=null,s="<")})(300,"","#define texture texture2D"),"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp int;\nprecision highp float;\n#else\nprecision mediump int;\nprecision mediump float;\n#endif\n#ifndef PI\n#define PI 3.141592653589793\n#endif\n#ifndef TAU\n#define TAU 6.283185307179586\n#endif\n#ifndef HALF_PI\n#define HALF_PI 1.570796326794896\n#endif\n"),Gi=Object.freeze([1,0,0,1]),Oi=(Object.freeze([1,0,0,1,0,0]),Object.freeze([1,0,0,0,1,0,0,0,1])),Li=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ui=-1/0,Di=1/0,Fi=(Object.freeze([Ui,Ui]),Object.freeze([Di,Di]),Object.freeze([1,1]),Object.freeze([0,0])),Bi=(Object.freeze([1,0]),Object.freeze([0,1]),Object.freeze([Ui,Ui,Ui]),Object.freeze([Di,Di,Di]),Object.freeze([1,1,1]),Object.freeze([0,0,0])),wi=(Object.freeze([1,0,0]),Object.freeze([0,1,0]),Object.freeze([0,0,1]),Object.freeze([Ui,Ui,Ui,Ui]),Object.freeze([Di,Di,Di,Di]),Object.freeze([1,1,1,1]),Object.freeze([0,0,0,0])),Pi=(Object.freeze([1,0,0,0]),Object.freeze([0,1,0,0]),Object.freeze([0,0,1,0]),Object.freeze([0,0,0,1]),e=>(t,n,s=0)=>{let i;return r=>{(r=void 0===r?s:r)!==i&&(t["uniform1"+e](n,r),i=r)}}),$i=(e,t)=>(n,s,i=t)=>{let r=[];return t=>{Z(r,t=void 0===t?i:t)||(n["uniform"+e](s,t),r=[...t])}},Ci=(e,t)=>(n,s,i=t)=>{let r=[];return t=>{Z(r,t=void 0===t?i:t)||(n["uniformMatrix"+e](s,!1,t),r=[...t])}},Mi=[0],xi={bool:Pi("i"),float:Pi("f"),int:Pi("i"),uint:Pi("ui"),bvec2:$i("2iv",Fi),bvec3:$i("3iv",Bi),bvec4:$i("4iv",wi),ivec2:$i("2iv",Fi),ivec3:$i("3iv",Bi),ivec4:$i("4iv",wi),vec2:$i("2fv",Fi),vec3:$i("3fv",Bi),vec4:$i("4fv",wi),mat2:Ci("2fv",Gi),mat3:Ci("3fv",Oi),mat4:Ci("4fv",Li),sampler2D:Pi("i"),sampler2DShadow:Pi("i"),sampler3D:Pi("i"),samplerCube:Pi("i"),samplerCubeShadow:Pi("i"),"bool[]":$i("1iv",Mi),"float[]":$i("1fv",Mi),"int[]":$i("1iv",Mi),"uint[]":$i("1uiv",Mi),"bvec2[]":$i("2iv",Fi),"bvec3[]":$i("3iv",Bi),"bvec4[]":$i("4iv",wi),"ivec2[]":$i("2iv",Fi),"ivec3[]":$i("3iv",Bi),"ivec4[]":$i("4iv",wi),"vec2[]":$i("2fv",Fi),"vec3[]":$i("3fv",Bi),"vec4[]":$i("4fv",wi),"mat2[]":Ci("2fv",Fi),"mat3[]":Ci("3fv",Bi),"mat4[]":Ci("4fv",wi),"sampler2D[]":$i("1iv",Mi),"sampler2DShadow[]":$i("1iv",Mi),"sampler3D[]":$i("1iv",Mi),"samplerCube[]":$i("1iv",Mi),"samplerCubeShadow[]":$i("1iv",Mi)},Hi=/ERROR: \d+:(\d+): (.*)/;class ji{constructor(e,t,n,s,i){this.gl=e,this.program=t,this.attribs=n,this.uniforms=s,this.state=i||{}}bind(e){return!!this.program&&(this.gl.useProgram(this.program),this.bindAttribs(e.attribs),this.bindUniforms(e.uniforms),!0)}unbind(){let e;for(let t in this.attribs)(e=this.attribs[t])&&this.gl.disableVertexAttribArray(e.loc);return this.gl.useProgram(null),!0}release(){return!!this.program&&(this.gl.deleteProgram(this.program),delete this.program,!0)}bindAttribs(e){const t=this.gl;let n;for(let s in e)if(n=this.attribs[s]){const i=e[s];i.buffer.bind(),t.enableVertexAttribArray(n.loc),t.vertexAttribPointer(n.loc,i.size||3,i.type||t.FLOAT,i.normalized||!1,i.stride||0,i.offset||0)}else yi.warn("unknown attrib: "+s)}bindUniforms(e={}){const t=this.uniforms;for(let n in e){const s=t[n];if(s){let i=e[n];i=w(i)?i(t,e):Ge(i),s.setter(i)}else yi.warn("unknown uniform: "+n)}for(let n in t)if(t.hasOwnProperty(n)&&(!e||!ci(e[n]))){const s=t[n],i=s.defaultFn?s.defaultFn(t,e):s.defaultVal;s.setter(i)}}prepareState(e=this.state){const t=this.gl;void 0!==e.depth&&this.setState(t.DEPTH_TEST,e.depth),void 0!==e.cull&&(this.setState(t.CULL_FACE,e.cull),e.cullMode&&t.cullFace(e.cullMode)),void 0!==e.blend&&(this.setState(t.BLEND,e.blend),e.blendFn&&t.blendFunc(e.blendFn[0],e.blendFn[1]),void 0!==e.blendEq&&t.blendEquation(e.blendEq)),void 0!==e.stencil&&(this.setState(t.STENCIL_TEST,e.stencil),e.stencilFn&&t.stencilFunc(e.stencilFn[0],e.stencilFn[1],e.stencilFn[2]),e.stencilOp&&t.stencilOp(e.stencilOp[0],e.stencilOp[1],e.stencilOp[2]),void 0!==e.stencilMask&&t.stencilMask(e.stencilMask))}setState(e,t){t?this.gl.enable(e):this.gl.disable(e)}}const ki=(e,t)=>{const n=si(e)?ui.GLES_300:ui.GLES_100,s=w(t.vs)?Vi(t,"vs",n):Xi(t,"vs",n),i=w(t.fs)?Vi(t,"fs",n):Xi(t,"fs",n);yi.debug(s),yi.debug(i),qi(e,t.ext);const r=Ki(e,e.VERTEX_SHADER,s),o=Ki(e,e.FRAGMENT_SHADER,i),a=e.createProgram()||ri("error creating shader program");if(e.attachShader(a,r),e.attachShader(a,o),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)){const n=Zi(e,a,t.attribs),s=Ji(e,a,t.uniforms);return e.deleteShader(r),e.deleteShader(o),new ji(e,a,n,s,t.state)}throw new Error("Error linking shader: "+e.getProgramInfoLog(a))},zi=(e,t,n)=>{let s=[];for(let i in e)e.hasOwnProperty(i)&&s.push(t(i,e[i],n));return s.push(""),s.join("\n")},Yi=(e,t,n)=>{const s=Ni[e],i=n===ui.GLES_300;return s&&(!i&&s.gl||i&&s.gl2)?`#extension ${s&&s.alias||e} : ${Ct(t)?t?"enable":"disable":t}\n`:""},qi=(e,t)=>{if(t)for(let n in t){const s=t[n];!0!==s&&"require"!==s||Ai(e,[n],"require"===s)}},Vi=(e,t,n)=>{let s="";if(s+=e.pre?e.replacePrelude?e.pre:e.pre+"\n"+bi:bi,e.ext)for(let t in e.ext)s+=Yi(t,e.ext[t],n);const i={},r={},o={},a={};if(e.uniforms)for(let t in e.uniforms){const n=e.uniforms[t];a[t]=E(n)?n[0].indexOf("[]")>0?Dt(n[0],t,{num:n[1]}):Dt(n[0],t):Dt(n,t)}if("vs"===t){for(let t in e.attribs){const n=e.attribs[t];i[t]=E(n)?Lt(n[0],t,{loc:n[1]}):Lt(n,t)}if(e.varying)for(let t in e.varying){const[n,s]=Wi(e.varying[t]);r[t]=Ut(n,t,s)}}else{if(e.varying)for(let t in e.varying){const[n,s]=Wi(e.varying[t]);i[t]=Lt(n,t,s)}const t=e.outputs||vi;if(n>=ui.GLES_300)for(let e in t){const n=t[e];r[e]=E(n)?Ut(n[0],e,{loc:n[1]}):Ut(n,e)}else for(let e in t){const i=t[e];E(i)&&"vec4"===i[0]?(s+=`#define ${e} gl_FragData[${i[1]}]\n`,o[e]=Ot("vec4",e)):Ln(`GLSL ${n} doesn't support output vars`)}}const l=(e=>{const t=Object.assign({type:"fs",version:ui.GLES_300,versionPragma:!0,prelude:""},e),n="vs"===t.type,s=(e,t=", ")=>e.map(o).join(t),i=e=>`${e.id}(${s(e.args)})`,r=(e,s=!1)=>{const{id:i,type:r,opts:a,init:l}=e,c=[];if(a.type){let e;t.version<ui.GLES_300?n?e={in:"attribute",out:"varying",uni:"uniform"}[a.type]:(e={in:"varying",out:null,uni:"uniform"}[a.type],!e&&Ln("GLSL 100 doesn't support fragment shader output variables")):(null!=a.loc&&c.push(`layout(location=${a.loc}) `),null!=a.smooth&&c.push(a.smooth+" "),e="uni"===a.type?"uniform":a.type),c.push(e+" ")}else a.const&&c.push("const "),s&&a.q&&c.push(a.q+" ");return a.prec&&c.push(a.prec+" "),c.push((e=>e.replace("[]",""))(r)," ",i),a.num&&c.push(`[${a.num}]`),l&&c.push(" = ",o(l)),c.join("")},o=gi({arg:e=>r(e,!0),array_init:e=>t.version>=ui.GLES_300?`${e.type}(${s(e.init)})`:Ln("array initializers not available in GLSL "+t.version),assign:e=>o(e.l)+" = "+o(e.r),ctrl:e=>e.id,call:i,call_i:e=>"texture"===e.id&&t.version<ui.GLES_300?`${e.id}${e.args[0].type.substr(7)}(${s(e.args)})`:i(e),decl:e=>r(e.id),fn:e=>`${e.type} ${e.id}(${s(e.args)}) ${o(e.scope)}`,for:e=>`for(${e.init?o(e.init):""}; ${o(e.test)}; ${e.iter?o(e.iter):""}) ${o(e.scope)}`,idx:e=>`${o(e.val)}[${o(e.id)}]`,if:e=>{const t=`if (${o(e.test)}) `+o(e.t);return e.f?t+" else "+o(e.f):t},lit:e=>{const t=e.val;switch(e.type){case"bool":return Ct(t)?String(t):`bool(${o(t)})`;case"float":return $t(t)?t===Math.trunc(t)?t+".0":String(t):`float(${o(t)})`;case"int":case"uint":return $t(t)?String(t):`${e.type}(${o(t)})`;default:return vt(e)||At(e)?`${e.type}(${s(t)})`:Ln("unknown type: "+e.type)}},op1:e=>e.post?`(${o(e.val)}${e.op})`:`(${e.op}${o(e.val)})`,op2:e=>`(${o(e.l)} ${e.op} ${o(e.r)})`,ret:e=>"return"+(e.val?" "+o(e.val):""),scope:e=>{let n=e.body.map(o).reduce((e,t)=>(e.push(Ri.test(t)?t:t+";"),e),[]).join("\n");return n+=e.body.length&&!Ri.test(n)?";":"",e.global?(t.prelude&&(n=t.prelude+"\n"+n),t.versionPragma&&(n=`#version ${t.version}\n`+n),n):`{\n${n}\n}`},swizzle:e=>`${o(e.val)}.${e.id}`,sym:e=>e.id,ternary:e=>`(${o(e.test)} ? ${o(e.t)} : ${o(e.f)})`,while:e=>`while (${o(e.test)}) ${o(e.scope)}`});return Object.assign(o,{gl_FragColor:Ot("vec4","gl_FragColor"),gl_FragCoord:Ot("vec4","gl_FragCoord",{const:!0}),gl_FragData:Ot("vec4[]","gl_FragData",{num:1}),gl_FrontFacing:Ot("bool","gl_FrontFacing",{const:!0}),gl_PointCoord:Ot("vec2","gl_PointCoord",{const:!0}),gl_PointSize:Ot("float","gl_PointSize"),gl_Position:Ot("vec4","gl_Position")}),o})({type:t,version:n,prelude:s});return l((e=>{const t=e.filter(e=>"fn"!==e.tag),n=e.reduce((e,t)=>"fn"===t.tag?bt(t,e):e,new Rt);return Gt(t.concat(n.sort()),!0)})([...Ii(a),...Ii(i),...Ii(r),...e[t](l,a,i,Object.assign(Object.assign({},r),o))]))+(e.post?"\n"+e.post:"")},Wi=e=>{const[t,n]=E(e)?[e[0],{num:e[1]}]:[e,{}];return/(u?int|[ui]vec[234])/.test(t)&&(n.smooth="flat"),[t,n]},Xi=(e,t,n)=>{const s=mi[n],i=Object.assign(Object.assign({},Ti),e.declPrefixes),r="vs"===t;let o="";if(o+=`#version ${n}\n`,o+=e.pre?e.replacePrelude?e.pre:e.pre+"\n"+bi:bi,e.ext)for(let t in e.ext)o+=Yi(t,e.ext[t],n);return!1!==e.generateDecls&&(o+=r?zi(e.attribs,s.attrib,i):zi(e.outputs||vi,s.output,i),o+=zi(e.varying,s.varying[t],i),o+=zi(e.uniforms,s.uniform,i)),o+=e[t],e.post&&(o+="\n"+e.post),o},Ki=(e,t,n)=>{const s=e.createShader(t)||ri("error creating shader");return e.shaderSource(s,n),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)?s:Qi(e,s,n)},Qi=(e,t,n)=>{const s=n.split("\n"),i=e.getShaderInfoLog(t).split("\n").map(e=>{const t=Hi.exec(e),n=t?t[1]:null;if(n)return`line ${n}: ${t[2]}\n${s[parseInt(n)-1]}`}).filter(ci).join("\n");return ri("Error compiling shader:\n"+i)},Zi=(e,t,n)=>{const s={};for(let i in n){const r=n[i],[o,a]=E(r)?r:[r,null],l=i;null!=a?(e.bindAttribLocation(t,a,l),s[i]={type:o,loc:a}):s[i]={type:o,loc:e.getAttribLocation(t,l)}}return s},Ji=(e,t,n={})=>{const s={};for(let i in n){const r=n[i];let o,a,l,c,u;E(r)?([o,a,l]=r,c=o.indexOf("[]")<0?a:l,w(c)&&(u=c,c=void 0)):o=r;const d=e.getUniformLocation(t,i);if(null!=d){const t=xi[o];t?s[i]={loc:d,setter:t(e,d,c),defaultFn:u,defaultVal:c,type:o}:ri("invalid uniform type: "+o)}else yi.warn("unknown uniform: "+i)}return s},er=e=>{if(e)for(let t,n=e.length;--n>=0;)(t=e[n])&&t.bind(n)},tr=e=>{if(e)for(let t,n=e.length;--n>=0;)(t=e[n])&&t.unbind(n)},nr=(e,t)=>{const n=si(e),s=n?void 0:e.getExtension("ANGLE_instanced_arrays");n||s||ri("instancing not supported");const i=t.shader.attribs,r=t.instances.attribs;t.shader.bindAttribs(r);for(let t in r){const o=i[t];if(o){let i=r[t].divisor;i=void 0!==i?i:1,n?e.vertexAttribDivisor(o.loc,i):s.vertexAttribDivisorANGLE(o.loc,i)}}if(t.indices){const i=t.indices.data instanceof Uint32Array?e.UNSIGNED_INT:e.UNSIGNED_SHORT;n?e.drawElementsInstanced(t.mode,t.num,i,0,t.instances.num):s.drawElementsInstancedANGLE(t.mode,t.num,i,0,t.instances.num)}else n?e.drawArraysInstanced(t.mode,0,t.num,t.instances.num):s.drawArraysInstancedANGLE(t.mode,0,t.num,t.instances.num);for(let t in r){const r=i[t];r&&(n?e.vertexAttribDivisor(r.loc,0):s.vertexAttribDivisorANGLE(r.loc,0))}t.shader.unbind(null)},sr=1e5,ir=[1,.7,.1,.001],rr=[.1,.9,1,.001],or=new W(sr),ar=or.defComponent({id:"pos",type:i.F32,size:2}),lr=or.defComponent({id:"vel",type:i.F32,size:2,default:()=>as([0,0])}),cr=or.defGroup([ar,lr]);for(let e=0;e<sr;e++)or.defEntity([ar,lr]);const ur=[0,0],dr=(e,t,n,s)=>{const{values:i,stride:r}=e.pos,{values:o,stride:a}=e.vel,l=1/t;for(let e=0;e<t;e++){const t=e*r,d=e*a,f=Vn(c=i,c,u=t,u,void 0,undefined);fs(i,i,f*s,t,t),f<4e4?(hs(o,o,ur,.01+.2*et((e+n)*l),d,d),ns(o,o,1,d,d)):(Kn(i,i,.98,t,t),as(o,1,void 0,d)),Es(i,i,o,t,t,d)}var c,u},fr={vs:(e,t,n,s)=>[Bt(()=>{return[Pt(s.vcol,ln(t.color,t.color2,dn(.006,(i=n.position,hn(i,"y"))))),Pt(e.gl_Position,dn(t.proj,nn(n.position,0,1))),Pt(e.gl_PointSize,Ht(2))];var i})],fs:(e,t,n,s)=>[Bt(()=>[Pt(s.fragColor,n.vcol)])],attribs:{position:"vec2"},varying:{vcol:"vec4"},uniforms:{proj:"mat4",color:"vec4",color2:"vec4"},state:{depth:!1,blend:!0,blendFn:Xs}};((e,t={},n=Qe)=>{const s=Object.assign({root:"app"},t);let i=[];const r=((e,t)=>g(e)?t.getElementById(e):e)(s.root,n),o=()=>{{s.ctx=((e,t)=>{if(null==e||!t||!t.length)return e;const n=Object.assign({},e);for(let e of t){const t=n[e];y(t,"deref")&&(n[e]=t.deref())}return n})(t.ctx,s.autoDerefKeys);const a=n.normalizeTree(s,e);null!=a&&(s.hydrate?(n.hydrateTree(s,r,a),s.hydrate=!1):n.diffTree(s,r,i,a),i=a),requestAnimationFrame(o)}};requestAnimationFrame(o)})((()=>{let e,t=[0,0];const n=((e,t,n)=>{let i,r,o=0,a=0;return{init(l,c,...u){i=l,s(i,i.width,i.height),r=i.getContext(e,n),a=Date.now(),t.init&&t.init(i,r,c,...u),t.update&&t.update(i,r,c,a,o++,...u)},render:(e,...n)=>(r&&t.update&&t.update(i,r,e,Date.now()-a,o++,...n),["canvas",n[0]]),release(e,...n){t.release&&t.release(i,r,e,...n)}}})("webgl",{init:(t,n)=>{e=((e,t,n=e.STATIC_DRAW)=>(t.attribPool?t.attribs=((e,t,n,s=e.ARRAY_BUFFER,i=e.STATIC_DRAW)=>{const r=((e,t,n=e.ARRAY_BUFFER,s=e.STATIC_DRAW)=>new oi(e,t,n,s))(e,t.bytes(),s,i),o={};for(let e of n||Object.keys(t.specs)){const n=t.specs[e];o[e]={buffer:r,size:n.size,type:n.type,stride:t.byteStride,offset:n.byteOffset}}return o})(e,t.attribPool,void 0,e.ARRAY_BUFFER,n):li(e,t.attribs,n),t.instances&&li(e,t.instances.attribs,n),((e,t,n=e.STATIC_DRAW)=>{t&&ai(e,t,e.ELEMENT_ARRAY_BUFFER,n)})(e,t.indices,n),null==t.mode&&(t.mode=Ks.TRIANGLES),t))(n,{attribs:{position:{data:ar.packedValues(),size:2}},shader:ki(n,fr),uniforms:{proj:tt([],-240,240,-240,240,0,1),color:ir,color2:rr},num:sr,mode:Ks.POINTS})},update:(n,i,r,o)=>{if(!e)return void s(n,480,480);o*=.001,Us(ur,ur,as(t),.1),cr.run(dr,o,4e-7*Math.sin(o/8)),e.attribs.position.buffer.set(e.attribs.position.data);const a=.3*Math.pow(Math.min(o/5,1),3);if(a<1){const t=e.uniforms.color,n=e.uniforms.color2;qs(t,t,a),qs(n,n,a)}i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),((e,t={})=>{const n=E(e)?e:[e];for(let e=0,s=n.length;e<s;e++){const s=n[e],i=s.indices,r=s.shader.gl;!1!==t.bindTex&&er(s.textures),!1!==t.shaderState&&s.shader.prepareState(),!1!==t.bindShader&&s.shader.bind(s),i&&i.buffer?(i.buffer.bind(),s.instances?nr(r,s):r.drawElements(s.mode,s.num,i.data instanceof Uint32Array?r.UNSIGNED_INT:r.UNSIGNED_SHORT,0)):s.instances?nr(r,s):r.drawArrays(s.mode,0,s.num),!1!==t.unbindShader&&s.shader.unbind(null),t.unbindTex&&tr(s.textures)}})(e)}},undefined);return()=>["div.bg-black.vh-100.flex.flex-column.items-center.justify-center",[n,{width:480,height:480}]]})())}});
